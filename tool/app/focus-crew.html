<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重点人员标注</title>
    <link rel="stylesheet" href="../../libs/bootstrap.min.css">
    <style>
        body { background: transparent; padding: 20px; }
        .container { max-width: 1400px; }
        .preview-wrapper { margin-top: 12px; overflow-x: auto; border: 1px solid #dee2e6; border-radius: 6px; max-height: 200px; }
        .preview-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .preview-table th { background: #f8f9fa; padding: 8px; text-align: left; border-bottom: 1px solid #dee2e6; white-space: nowrap; position: sticky; top: 0; }
        .preview-table td { padding: 6px 8px; border-bottom: 1px solid #dee2e6; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .config-row { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 12px; }
        .config-item { display: flex; align-items: center; gap: 8px; }
        .config-item label { font-size: 13px; white-space: nowrap; }
        .config-item select { padding: 6px 10px; border: 1px solid #dee2e6; border-radius: 4px; font-size: 13px; min-width: 120px; }
        .status { margin-top: 8px; padding: 6px 10px; border-radius: 4px; font-size: 12px; display: none; }
        .status-success { background: #d1e7dd; color: #0f5132; display: block; }
        .status-error { background: #f8d7da; color: #842029; display: block; }
        .status-info { background: #cff4fc; color: #055160; display: block; }
        .legend { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 6px; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .legend-color { width: 40px; height: 20px; border: 1px solid #dee2e6; border-radius: 3px; }
        .stats { display: flex; gap: 20px; margin-top: 12px; padding: 12px; background: #f8f9fa; border-radius: 6px; font-size: 13px; flex-wrap: wrap; }
        .stats-item { display: flex; align-items: center; gap: 6px; }
        .stats-num { font-weight: bold; color: #0d6efd; }
        .sheet-config { margin-bottom: 20px; padding: 15px; background: #fff; border: 1px solid #dee2e6; border-radius: 6px; }
        .sheet-config-title { font-weight: 600; font-size: 14px; margin-bottom: 10px; padding: 8px 12px; background: #f8f9fa; border-radius: 4px; }
        .sheet-config-title .badge { display: inline-block; padding: 2px 8px; border-radius: 3px; font-size: 12px; margin-left: 8px; }
        .badge-1 { background: #FFE5CC; color: #000; }
        .badge-2 { background: #FFF3CD; color: #000; }
        .badge-3 { background: #D1ECF1; color: #000; }
        .badge-4 { background: #D4EDDA; color: #000; }
        .badge-5 { background: #E2E3E5; color: #000; }
    </style>
</head>
<body>
<div class="container">
    <div class="card mb-4">
        <div class="card-body text-center position-relative">
            <a href="../../index.html" class="position-absolute start-0 top-50 translate-middle-y ms-3 text-decoration-none">返回首页</a>
            <h4 class="card-title mb-0">重点人员标注</h4>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title border-bottom pb-2 mb-3">第一步：上传审班表</h5>
            <input type="file" class="form-control" style="max-width:400px" id="scheduleFile" accept=".xlsx,.xls">
            <div id="scheduleStatus" class="status"></div>
            <div id="scheduleConfigSection" style="display:none;">
                <div class="config-row">
                    <div class="config-item"><label>员工号列:</label><select id="scheduleIdCol"></select></div>
                    <div class="config-item"><label>姓名列:</label><select id="scheduleNameCol"></select></div>
                </div>
                <div class="preview-wrapper"><table id="schedulePreview" class="preview-table"></table></div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title border-bottom pb-2 mb-3">第二步：上传重点人员表</h5>
            <input type="file" class="form-control" style="max-width:400px" id="focusFile" accept=".xlsx,.xls">
            <div id="focusStatus" class="status"></div>
            <div id="focusConfigSection" style="display:none;">
                <div id="focusSheetsConfig"></div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4" id="actionSection" style="display:none;">
        <div class="card-body">
            <h5 class="card-title border-bottom pb-2 mb-3">第三步：标注与导出</h5>
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background:#FFE5CC;"></div><span>重点关注</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#FFF3CD;"></div><span>一般关注</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#5b84f9;"></div><span>预防性关注</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#65c53f;"></div><span>三新人员</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#a584ed;"></div><span>长期关注</span></div>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button id="highlightBtn" class="btn btn-outline-secondary">开始标注</button>
                <button id="exportBtn" class="btn btn-outline-secondary" disabled>导出Excel</button>
            </div>
            <div id="resultStats" style="display:none;" class="stats"></div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title border-bottom pb-2 mb-3">使用说明</h5>
            <ol class="text-muted mb-0">
                <li>上传审班表，选择员工号列和姓名列</li>
                <li>上传重点人员表，为每个工作表分别选择员工号列和姓名列</li>
                <li>点击"开始标注"进行匹配</li>
                <li>系统会按姓名匹配，对姓名列进行颜色标注</li>
                <li>如果一个人属于多个类别，会在姓名后加标记，如"张三[重点][一般]"</li>
                <li>颜色优先级：重点 > 一般 > 预防 > 三新 > 长期</li>
                <li>点击"导出Excel"下载标注后的审班表</li>
                <li class="text-danger">注意：导出的Excel中日期时间格式会丢失，建议将导出表的姓名列复制回原表</li>
            </ol>
        </div>
    </div>
</div>

<script src="../../libs/xlsx-js-style.min.js"></script>
<script src="focus-crew.js"></script>
</body>
</html>
