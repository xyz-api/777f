<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档</title>
    <link rel="stylesheet" href="../libs/bootstrap.min.css">
    <style>
        body { background: transparent; padding: 20px; }
        .container { max-width: 900px; }
        .markdown-body { font-size: 15px; line-height: 1.8; }
        .markdown-body h1 { font-size: 28px; margin: 0 0 16px; padding-bottom: 12px; border-bottom: 1px solid #dee2e6; }
        .markdown-body h2 { font-size: 22px; margin: 32px 0 16px; padding-bottom: 8px; border-bottom: 1px solid #dee2e6; }
        .markdown-body h3 { font-size: 18px; margin: 24px 0 12px; }
        .markdown-body p { margin: 0 0 16px; }
        .markdown-body ul, .markdown-body ol { margin: 0 0 16px; padding-left: 24px; }
        .markdown-body li { margin-bottom: 6px; }
        .markdown-body code { background: #f8f9fa; padding: 2px 6px; border-radius: 4px; font-family: Consolas, Monaco, monospace; font-size: 14px; }
        .markdown-body pre { background: #f8f9fa; padding: 16px; border-radius: 8px; overflow-x: auto; margin: 0 0 16px; }
        .markdown-body pre code { background: none; padding: 0; }
        .markdown-body blockquote { margin: 0 0 16px; padding: 12px 16px; background: #f8f9fa; color: #6c757d; border-left: 4px solid #dee2e6; }
        .markdown-body blockquote p { margin: 0; }
        .markdown-body table { width: 100%; border-collapse: collapse; margin: 0 0 16px; }
        .markdown-body th, .markdown-body td { border: 1px solid #dee2e6; padding: 10px 12px; text-align: left; }
        .markdown-body th { background: #f8f9fa; font-weight: 500; }
        .markdown-body img { max-width: 100%; border-radius: 8px; }
        .markdown-body a { color: #0d6efd; text-decoration: none; }
        .markdown-body a:hover { text-decoration: underline; }
        .loading { text-align: center; padding: 40px; color: #6c757d; }
        .error { text-align: center; padding: 40px; color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card mb-4">
            <div class="card-body text-center position-relative">
                <a href="index.html" class="position-absolute start-0 top-50 translate-middle-y ms-3 text-decoration-none">返回</a>
                <h4 class="card-title mb-0" id="docTitle">文档</h4>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div id="content" class="markdown-body">
                    <div class="loading">加载中...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="../libs/marked.min.js"></script>
    <script>
        async function loadDoc() {
            const params = new URLSearchParams(window.location.search);
            const docName = params.get('doc');
            
            if (!docName) {
                document.getElementById('content').innerHTML = '<div class="error">未指定文档</div>';
                return;
            }
            
            try {
                const resp = await fetch(`md/${docName}.md`);
                if (!resp.ok) throw new Error('文档不存在');
                
                const markdown = await resp.text();
                document.getElementById('content').innerHTML = marked.parse(markdown);
                
                // 所有外部链接在新窗口打开
                document.querySelectorAll('.markdown-body a').forEach(a => {
                    if (a.href && (a.href.startsWith('http://') || a.href.startsWith('https://'))) {
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                    }
                });
                
                // 从markdown中提取标题
                const titleMatch = markdown.match(/^#\s+(.+)$/m);
                if (titleMatch) {
                    document.getElementById('docTitle').textContent = titleMatch[1];
                    document.title = titleMatch[1] + ' - 文档中心';
                }
            } catch (error) {
                document.getElementById('content').innerHTML = `<div class="error">加载失败: ${error.message}</div>`;
            }
        }
        
        loadDoc();
    </script>
</body>
</html>
